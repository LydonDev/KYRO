import{r as a,u as D,R as O,j as e,L as B,d as y,a as N,B as p}from"./main-D6weWVn6.js";const V=()=>{const[u,v]=a.useState(""),[c,n]=a.useState(!1),[i,o]=a.useState(""),[F,x]=a.useState(!1),[b,w]=a.useState(!1),[l,C]=a.useState(Array(6).fill("")),[m,A]=a.useState(null),[d,P]=a.useState(""),[f,S]=a.useState(""),k=D(),h=Array(6).fill(0).map(()=>O.createRef()),E=(t,s)=>{var g;if(isNaN(Number(s)))return;const r=[...l];r[t]=s,C(r),s&&t<5&&((g=h[t+1].current)==null||g.focus())},R=(t,s)=>{var r;s.key==="Backspace"&&!l[t]&&t>0&&((r=h[t-1].current)==null||r.focus())},j=async t=>{if(t.preventDefault(),!u){o("Please enter your email address");return}n(!0),o("");try{const s=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u})}),r=await s.json();if(!s.ok)throw new Error(r.error||"Failed to send reset email");x(!0),A(r.userId),w(!0)}catch(s){o(s instanceof Error?s.message:"An error occurred")}finally{n(!1)}},L=async t=>{if(t.preventDefault(),l.some(s=>!s)){o("Please enter all digits of the verification code");return}if(!m){o("User information is missing");return}n(!0),o("");try{const s=await fetch("/api/auth/verify-reset-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m,code:l.join("")})}),r=await s.json();if(!s.ok)throw new Error(r.error||"Invalid verification code");x(!0),w(!1)}catch(s){o(s instanceof Error?s.message:"Verification failed")}finally{n(!1)}},T=async t=>{if(t.preventDefault(),!d||!f){o("Please enter and confirm your new password");return}if(d!==f){o("Passwords do not match");return}if(d.length<8){o("Password must be at least 8 characters long");return}if(!m){o("User information is missing");return}n(!0),o("");try{const s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m,password:d,code:l.join("")})}),r=await s.json();if(!s.ok)throw new Error(r.error||"Failed to reset password");x(!0),setTimeout(()=>{k("/login")},2e3)}catch(s){o(s instanceof Error?s.message:"Password reset failed")}finally{n(!1)}};return c?e.jsx(B,{}):e.jsxs("div",{className:"min-h-screen flex bg-stone-950",children:[e.jsxs("div",{className:"w-2/5 p-10 flex flex-col justify-center border-r border-stone-900",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-2xl font-semibold text-[#FFFFFF]",children:y})}),e.jsxs("div",{className:"my-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-[#FFFFFF]",children:"Reset your password"}),e.jsx("p",{className:"text-lg mt-2 text-[#9CA3AF]",children:"We'll help you get back into your account."})]}),e.jsx("div",{className:"mt-8",children:e.jsxs(N,{to:"https://github.com/lydondev",className:"inline-flex items-center border-b border-stone-900 pb-1 text-[#9CA3AF]",children:["Powered by ",y,e.jsx("svg",{className:"ml-1 w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})})]}),e.jsx("div",{className:"w-3/5 flex items-center justify-center bg-stone-950",children:e.jsx("div",{className:"bg-stone-950 rounded-xl p-8 w-full max-w-md border border-stone-900",children:!b&&!F?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-semibold text-[#FFFFFF] mb-1",children:"Forgot Password"}),e.jsx("p",{className:"text-sm text-[#9CA3AF] mb-6",children:"Enter your email address to receive a verification code."}),e.jsxs("form",{onSubmit:j,className:"space-y-5",children:[i&&e.jsx("div",{className:"bg-stone-950 border border-stone-900 rounded-md p-3 mb-4",children:e.jsx("p",{className:"text-xs text-[#EF4444]",children:i})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-xs font-medium text-[#9CA3AF] mb-1.5",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",value:u,onChange:t=>v(t.target.value),className:"block w-full px-3 py-2 rounded-md border border-stone-900 bg-stone-950 text-[#FFFFFF] text-sm transition-colors duration-200 focus:outline-none focus:ring-1 focus:ring-stone-900",placeholder:"email@example.com",required:!0})]}),e.jsx(p,{type:"submit",variant:"secondary",size:"md",className:"w-full",isLoading:c,children:"Send Reset Link"}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-sm text-[#9CA3AF]",children:["Remember your password? ",e.jsx(N,{to:"/login",children:"Sign in"})]})})]})]}):b?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-semibold text-[#FFFFFF] mb-1",children:"Verification Code"}),e.jsx("p",{className:"text-sm text-[#9CA3AF] mb-6",children:"Enter the 6-digit code sent to your email."}),e.jsxs("form",{onSubmit:L,className:"space-y-5",children:[i&&e.jsx("div",{className:"bg-stone-950 border border-stone-900 rounded-md p-3 mb-4",children:e.jsx("p",{className:"text-xs text-[#EF4444]",children:i})}),e.jsx("div",{className:"flex justify-center space-x-2 my-6",children:l.map((t,s)=>e.jsx("input",{ref:h[s],type:"text",maxLength:1,value:t,onChange:r=>E(s,r.target.value),onKeyDown:r=>R(s,r),className:"w-10 h-12 border border-stone-900 rounded text-center text-[#FFFFFF] font-medium text-lg bg-stone-950 focus:outline-none focus:ring-1 focus:ring-stone-900"},s))}),e.jsx(p,{type:"submit",variant:"primary",size:"md",className:"w-full",isLoading:c,children:"Verify Code"}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("p",{className:"text-sm text-[#9CA3AF]",children:["Didn't receive a code?"," ",e.jsx("button",{type:"button",onClick:j,className:"text-[#FFFFFF] hover:text-[#9CA3AF]",children:"Resend"})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-semibold text-[#FFFFFF] mb-1",children:"Reset Password"}),e.jsx("p",{className:"text-sm text-[#9CA3AF] mb-6",children:"Create a new secure password for your account."}),e.jsxs("form",{onSubmit:T,className:"space-y-5",children:[i&&e.jsx("div",{className:"bg-stone-950 border border-stone-900 rounded-md p-3 mb-4",children:e.jsx("p",{className:"text-xs text-[#EF4444]",children:i})}),F&&e.jsx("div",{className:"bg-stone-950 border border-stone-900 rounded-md p-3 mb-4",children:e.jsx("p",{className:"text-xs text-[#10B981]",children:"Password reset successful! Redirecting to login..."})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-xs font-medium text-[#9CA3AF] mb-1.5",children:"New Password"}),e.jsx("input",{id:"newPassword",type:"password",value:d,onChange:t=>P(t.target.value),className:"block w-full px-3 py-2 rounded-md border border-stone-900 bg-stone-950 text-[#FFFFFF] text-sm transition-colors duration-200 focus:outline-none focus:ring-1 focus:ring-stone-900",placeholder:"New password",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-xs font-medium text-[#9CA3AF] mb-1.5",children:"Confirm Password"}),e.jsx("input",{id:"confirmPassword",type:"password",value:f,onChange:t=>S(t.target.value),className:"block w-full px-3 py-2 rounded-md border border-stone-900 bg-stone-950 text-[#FFFFFF] text-sm transition-colors duration-200 focus:outline-none focus:ring-1 focus:ring-stone-900",placeholder:"Confirm new password",required:!0})]}),e.jsx(p,{type:"submit",variant:"primary",size:"md",className:"w-full",isLoading:c,children:"Reset Password"})]})]})})})]})};export{V as default};
