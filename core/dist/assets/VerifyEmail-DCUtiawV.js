import{r as a,u as P,g as A,R as L,j as s,N as T,d as B,B as S}from"./main-D6weWVn6.js";const O=()=>{const[o,x]=a.useState(Array(6).fill("")),[f,g]=a.useState(!1),[y,n]=a.useState(""),[I,E]=a.useState(!1),[p,b]=a.useState(!1),[k,u]=a.useState(!1),[c,v]=a.useState({userId:null,token:null,requiresVerification:!0}),m=P(),l=A();a.useEffect(()=>{var i;const e=localStorage.getItem("userId"),t=localStorage.getItem("token"),r=localStorage.getItem("requiresVerification")==="true";(i=l.state)!=null&&i.userId?v({userId:l.state.userId,token:l.state.token,requiresVerification:l.state.requiresVerification}):e&&t&&r?v({userId:e,token:t,requiresVerification:r}):m("/login")},[l,m]);const d=Array(6).fill(0).map(()=>L.createRef());a.useEffect(()=>{o.every(e=>e!=="")&&!f&&j()},[o]);const V=(e,t)=>{var i;if(isNaN(Number(t)))return;const r=[...o];r[e]=t,x(r),t&&e<5&&((i=d[e+1].current)==null||i.focus())},C=(e,t)=>{var r;t.key==="Backspace"&&!o[e]&&e>0&&((r=d[e-1].current)==null||r.focus())},R=e=>{var r,i;e.preventDefault();const t=e.clipboardData.getData("text").trim();if(/^\d+$/.test(t)){const h=t.split("").slice(0,6),N=[...o];h.forEach((D,w)=>{w<6&&(N[w]=D)}),x(N),h.length<6?(r=d[h.length].current)==null||r.focus():(i=d[5].current)==null||i.focus()}},j=async e=>{if(e&&e.preventDefault(),o.some(t=>!t)){n("Please enter all digits of the verification code");return}if(!c.userId){n("Unable to verify: missing user information");return}g(!0),n("");try{const t=await fetch("/api/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:c.userId,code:o.join("")})}),r=await t.json();if(!t.ok)throw new Error(r.error||"Failed to verify email");localStorage.setItem("token",r.token),localStorage.removeItem("requiresVerification"),localStorage.removeItem("userId"),E(!0),setTimeout(()=>{m("/servers")},2e3)}catch(t){n(t instanceof Error?t.message:"Verification failed")}finally{g(!1)}},q=async()=>{if(!(!c.token||!c.userId)){b(!0),u(!1);try{const e=await fetch("/api/auth/resend-verification",{method:"POST",headers:{Authorization:`Bearer ${c.token}`,"Content-Type":"application/json"}});if(!e.ok){const t=await e.json();throw new Error(t.error||"Failed to resend code")}u(!0),n(""),setTimeout(()=>{u(!1)},5e3)}catch(e){n(e instanceof Error?e.message:"Failed to resend verification code")}finally{b(!1)}}};return c.requiresVerification?s.jsxs("div",{className:"min-h-screen flex bg-stone-950",children:[s.jsxs("div",{className:"w-2/5 p-10 flex flex-col justify-center border-r border-stone-900",children:[s.jsx("div",{className:"mb-8",children:s.jsx("h1",{className:"text-2xl font-semibold text-white",children:B})}),s.jsxs("div",{className:"my-6",children:[s.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Verify your email"}),s.jsx("p",{className:"text-lg mt-2 text-gray-400",children:"We've sent a 6-digit code to your email address."})]})]}),s.jsx("div",{className:"w-3/5 flex items-center justify-center bg-stone-950",children:s.jsxs("div",{className:"w-full max-w-md p-8 bg-stone-950 border border-stone-900 rounded-xl",children:[s.jsx("h2",{className:"text-2xl font-semibold mb-1 text-white",children:"Email verification"}),s.jsx("p",{className:"text-sm mb-6 text-gray-400",children:"Enter the 6-digit code sent to your email to verify your account."}),s.jsxs("form",{onSubmit:j,className:"space-y-5",children:[y&&s.jsx("div",{className:"p-3 mb-4 rounded-md bg-stone-950 border border-stone-900",children:s.jsx("p",{className:"text-xs text-red-500",children:y})}),I&&s.jsx("div",{className:"p-3 mb-4 rounded-md bg-stone-950 border border-stone-900",children:s.jsx("p",{className:"text-xs text-green-500",children:"Email verified successfully! Redirecting..."})}),k&&s.jsx("div",{className:"p-3 mb-4 rounded-md bg-stone-950 border border-stone-900",children:s.jsx("p",{className:"text-xs text-white",children:"A new verification code has been sent to your email."})}),s.jsx("div",{className:"flex justify-between space-x-2",children:o.map((e,t)=>s.jsx("input",{ref:d[t],type:"text",maxLength:1,value:e,onChange:r=>V(t,r.target.value),onKeyDown:r=>C(t,r),onPaste:R,className:"w-12 h-12 text-center text-lg rounded-md bg-stone-950 border border-stone-900 text-white focus:outline-none disabled:opacity-50",disabled:f},t))}),s.jsxs("div",{className:"flex flex-col space-y-4",children:[s.jsx(S,{type:"submit",variant:"secondary",className:"w-full py-3",disabled:f,children:f?"Verifying...":"Verify Email"}),s.jsx(S,{type:"button",variant:"primary",onClick:q,className:"w-full py-3",disabled:p,children:p?"Sending...":"Resend Code"})]})]})]})})]}):s.jsx(T,{to:"/servers"})};export{O as default};
