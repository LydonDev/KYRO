import{h as V,r as l,j as e,d as Be,B as N,b as pe,c as Oe,u as Ie,m as Re,L as Le}from"./main-D6weWVn6.js";import{C as I}from"./card-DxFMsxNs.js";import{P as ze,A as fe,T as Q}from"./trash-BRkT18N2.js";import{P as je}from"./pencil-DEEDJ0E3.js";import{C as ge}from"./chevron-right-DT_2dYLm.js";import{F as Ke}from"./folder-S0hP_hFp.js";import{E as _e}from"./ellipsis-vertical-6VIw1Tgp.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ve=V("check",Ue);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ge=V("chevron-left",We);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Je=V("copy",He);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Ze=V("server",Qe);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ye=V("triangle-alert",Xe),re=({type:x,message:D,onDismiss:F})=>{const L="bg-stone-950",b=x==="error"?"text-red-600":x==="success"?"text-green-600":"text-yellow-600",A=x==="error"?"border-red-100":x==="success"?"border-green-100":"border-yellow-100";return e.jsxs("div",{className:`${L} border ${A} rounded-md flex items-start justify-between`,children:[e.jsxs("div",{className:"flex items-start p-2",children:[x==="error"||x==="warning"?e.jsx(Ye,{className:`w-3 h-3 ${b} mr-2 mt-0.5`}):null,e.jsx("p",{className:`text-xs ${b}`,children:D})]}),F&&e.jsx("button",{onClick:F,className:`ml-2 mr-2 p-1 ${b} hover:bg-opacity-10 cursor-pointer rounded-full`,children:"×"})]})},et=({position:x,onClose:D,onEdit:F,onDelete:L})=>{const b=l.useRef(null),[A,Z]=l.useState(x),{user:P}=Oe(),E=Ie();l.useEffect(()=>{(!P||!P.permissions.includes("admin"))&&E("/unauthorized",{replace:!0})},[P,E]),l.useEffect(()=>{const a=w=>{b.current&&w.target instanceof Node&&!b.current.contains(w.target)&&D()},m=()=>{if(b.current){const w=b.current.getBoundingClientRect(),C={width:window.innerWidth,height:window.innerHeight};let R=x.x,f=x.y;R+w.width>C.width&&(R=Math.max(0,C.width-w.width-16)),f+w.height>C.height&&(f=Math.max(0,C.height-w.height-16)),Z({x:R,y:f})}};document.addEventListener("mousedown",a);const $=setTimeout(m,10);return()=>{document.removeEventListener("mousedown",a),clearTimeout($)}},[D,x]);const y=[{label:"Edit",icon:je,action:F},{label:"Delete",icon:Q,action:L,destructive:!0}];return e.jsx(Re.div,{ref:b,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1},className:"fixed z-50 w-36 bg-stone-950 border border-stone-900 rounded-lg py-1",style:{top:A.y,left:A.x},children:y.map(({label:a,icon:m,action:$,destructive:w})=>e.jsxs("button",{onClick:C=>{C.stopPropagation(),$()},className:`w-full px-3 py-2 text-left flex items-center space-x-2 text-sm ${w?"text-red-500 hover:bg-red-900/20":"text-[#9CA3AF] hover:bg-stone-900"}`,children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:a})]},a))})},lt=()=>{const[x,D]=l.useState([]),[F,L]=l.useState([]),[b,A]=l.useState(!0),[Z,P]=l.useState(null),[E,y]=l.useState("list"),[a,m]=l.useState(null),[$,w]=l.useState(!1),[C,R]=l.useState([]),[f,S]=l.useState({name:"",fqdn:"",port:8080}),[h,W]=l.useState("overview"),[u,q]=l.useState({bindAddress:"0.0.0.0"}),[ve,Ne]=l.useState("single"),[ne,X]=l.useState(null),[ae,z]=l.useState(null),[ye,oe]=l.useState(!1),[we,be]=l.useState(""),[ie,Y]=l.useState([]),[p,T]=l.useState({page:1,limit:10,total:0}),[le,ke]=l.useState("name"),[Ce,ce]=l.useState("asc"),[B,G]=l.useState(null);console.log(Z),l.useEffect(()=>{a&&a.allocations&&h==="allocations"&&T(s=>({...s,total:a.allocations?a.allocations.length:0}))},[a,h]),l.useEffect(()=>{H()},[]);const g=l.useCallback((s,t)=>{const n=Date.now().toString();return Y(r=>[...r,{id:n,type:s,message:t}]),setTimeout(()=>{Y(r=>r.filter(i=>i.id!==n))},5e3),n},[]),Fe=l.useCallback(s=>{Y(t=>t.filter(n=>n.id!==s))},[]),Ae=async s=>{try{const t=await fetch(`http://${s.fqdn}:${s.port}/api/v1/state`);if(!t.ok)throw new Error("Failed to fetch node state");return await t.json()}catch(t){return console.error(`Failed to fetch state for node ${s.fqdn}:`,t),null}},H=async()=>{try{A(!0);const t={Authorization:`Bearer ${localStorage.getItem("token")}`},[n,r]=await Promise.all([fetch("/api/nodes",{headers:t}),fetch("/api/servers",{headers:t})]);if(!n.ok){const d=await n.json();throw new Error(d.error||"Failed to fetch nodes")}if(!r.ok){const d=await r.json();throw new Error(d.error||"Failed to fetch servers")}const[i,c]=await Promise.all([n.json(),r.json()]),j=i.map(d=>{const k=c.filter(M=>M.node.id===d.id);return{...d,resources:{memoryAllocated:k.reduce((M,O)=>M+O.memoryMiB*1024*1024,0),diskAllocated:k.reduce((M,O)=>M+(O.diskMiB||0)*1024*1024,0),cpuAllocated:k.reduce((M,O)=>M+O.cpuPercent,0)}}}),J=await Promise.all(j.map(async d=>{if(d.isOnline){const k=await Ae(d);return{...d,systemState:k}}return d}));if(D(J),L(c),a&&E==="view"){const d=J.find(k=>k.id===a.id);d&&(m(d),h==="allocations"&&d.allocations&&T(k=>({...k,total:d.allocations?d.allocations.length:0})))}P(null)}catch(s){const t=s instanceof Error?s.message:"An error occurred";P(t),g("error",t)}finally{A(!1)}},ee=async s=>{try{A(!0);const t=localStorage.getItem("token"),n=await fetch(`/api/nodes/${s}`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to fetch node")}const r=await n.json();return D(i=>i.map(c=>c.id===s?r:c)),a&&a.id===s&&(m(r),h==="allocations"&&r.allocations&&T(i=>({...i,total:r.allocations?r.allocations.length:0}))),P(null),r}catch(t){const n=t instanceof Error?t.message:"An error occurred";return g("error",n),null}finally{A(!1)}},Se=async s=>{s.preventDefault(),z(null);try{const t=localStorage.getItem("token"),n=await fetch("/api/nodes",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(f)}),r=await n.json();if(!n.ok){const i=Array.isArray(r.error)?r.error.map(c=>c.message).join(", "):r.error||"Failed to create node";throw new Error(i)}await H(),y("list"),S({name:"",fqdn:"",port:8080}),g("success",`Node "${f.name}" created successfully`)}catch(t){const n=t instanceof Error?t.message:"Failed to create node";z(n),g("error",n)}},Me=async s=>{if(s.preventDefault(),!!a){z(null);try{const t=localStorage.getItem("token"),n=await fetch(`/api/nodes/${a.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(f)}),r=await n.json();if(!n.ok){const c=Array.isArray(r.error)?r.error.map(j=>j.message).join(", "):r.error||"Failed to update node";throw new Error(c)}await H(),g("success",`Node "${f.name}" updated successfully`);const i=await ee(a.id);i&&m(i),y("view"),S({name:"",fqdn:"",port:8080})}catch(t){const n=t instanceof Error?t.message:"Failed to update node";z(n),g("error",n)}}},de=async s=>{try{const t=localStorage.getItem("token"),n=await fetch(`/api/nodes/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!n.ok){const r=await n.json();if(r.count&&r.count>0){g("warning",`Cannot delete node with ${r.count} active servers`);return}throw new Error(r.error||"Failed to delete node")}await H(),(a==null?void 0:a.id)===s&&(y("list"),m(null)),g("success","Node deleted successfully")}catch(t){const n=t instanceof Error?t.message:"Failed to delete node";g("error",n)}},Ee=async()=>{try{await navigator.clipboard.writeText(we),oe(!0),setTimeout(()=>oe(!1),2e3)}catch(s){console.error("Failed to copy connection key:",s),g("error","Failed to copy connection key")}},te=s=>{if(s===0)return"0 B";const t=1024,n=["B","KB","MB","GB","TB"],r=Math.floor(Math.log(s)/Math.log(t));return`${parseFloat((s/Math.pow(t,r)).toFixed(1))} ${n[r]}`},K=s=>{le===s?ce(t=>t==="asc"?"desc":"asc"):(ke(s),ce("asc"))},De=()=>[...x].sort((s,t)=>{let n=0;switch(le){case"name":n=s.name.localeCompare(t.name);break;case"fqdn":n=s.fqdn.localeCompare(t.fqdn);break;case"port":n=s.port-t.port;break;case"status":n=Number(t.isOnline)-Number(s.isOnline);break;case"servers":const r=F.filter(c=>c.node.id===s.id).length,i=F.filter(c=>c.node.id===t.id).length;n=r-i;break;default:n=0}return Ce==="asc"?n:-n}),xe=s=>e.jsxs("form",{onSubmit:s==="create"?Se:Me,className:"space-y-4 max-w-lg",children:[ae&&e.jsx(re,{type:"error",message:ae,onDismiss:()=>z(null)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-[#FFFFFF]",children:"Name"}),e.jsx("input",{type:"text",value:f.name,onChange:t=>S({...f,name:t.target.value}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-white
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,placeholder:"node-1",required:!0,maxLength:100}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"A unique identifier for this node"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-[#FFFFFF]",children:"Hostname (FQDN)"}),e.jsx("input",{type:"text",value:f.fqdn,onChange:t=>S({...f,fqdn:t.target.value}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-white
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,placeholder:"node1.example.com",required:!0,pattern:"^(localhost|[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}|(\\d{1,3}\\.){3}\\d{1,3})$"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Must be a valid fully qualified domain name or an IP address"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-[#FFFFFF]",children:"Port"}),e.jsx("input",{type:"number",value:f.port,onChange:t=>S({...f,port:parseInt(t.target.value)}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-white
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,required:!0,min:1,max:65535}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Must be between 1 and 65535"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{type:"button",onClick:()=>{y(s==="edit"?"view":"list"),s==="create"&&m(null),S({name:"",fqdn:"",port:8080})},children:"Cancel"}),e.jsx(N,{type:"submit",variant:"secondary",children:s==="create"?"Create Node":"Update Node"})]})]}),me=async s=>{if(a)try{const t=localStorage.getItem("token"),n=await fetch(`/api/nodes/${a.id}/allocations/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to delete allocation")}const r=await ee(a.id);if(r&&(m(r),r.allocations)){const i=Math.ceil(r.allocations.length/p.limit);p.page>i&&i>0?T(c=>({...c,page:i,total:r.allocations?r.allocations.length:0})):T(c=>({...c,total:r.allocations?r.allocations.length:0}))}g("success","Allocation deleted successfully"),R([])}catch(t){const n=t instanceof Error?t.message:"Failed to delete allocation";g("error",n)}},Pe=(s,t)=>{const n=Math.max(1,Math.ceil(s.total/s.limit)),r=s.page;return e.jsxs("div",{className:"flex items-center justify-between mt-4 text-xs text-white",children:[e.jsxs("div",{className:"text-gray-400",children:["Showing"," ",Math.min((r-1)*s.limit+1,s.total)," ","to ",Math.min(r*s.limit,s.total)," of"," ",s.total," entries"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>t(Math.max(1,r-1)),disabled:r===1,className:"p-1 rounded border border-stone-900 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Ge,{className:"w-4 h-4"})}),Array.from({length:Math.min(5,n)},(i,c)=>{let j;return n<=5||r<=3?j=c+1:r>=n-2?j=n-4+c:j=r-2+c,e.jsx("button",{onClick:()=>t(j),className:`px-2 py-1 rounded ${r===j?"bg-stone-950 text-white":"border border-stone-900 hover:bg-stone-900"}`,children:j},j)}),e.jsx("button",{onClick:()=>t(Math.min(n,r+1)),disabled:r===n,className:"p-1 rounded border border-stone-900 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(ge,{className:"w-4 h-4"})})]})]})},$e=()=>{var he,ue;if(!a)return null;const s=a.allocations||[],t=s.filter(o=>o.assigned),n=s.filter(o=>!o.assigned),r=t.slice((p.page-1)*p.limit,p.page*p.limit),i=n.slice(Math.max(0,(p.page-1)*p.limit-t.length),Math.max(0,p.page*p.limit-t.length)),c=(p.page-1)*p.limit,j=p.page*p.limit,J=c<t.length,d=j>t.length,k=o=>{T(v=>({...v,page:o}))},M=async o=>{o.preventDefault(),w(!0),X(null);try{const v=localStorage.getItem("token"),_=await fetch(`/api/nodes/${a.id}/allocations`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!_.ok){const se=await _.json();throw new Error(se.error||"Failed to create allocation")}const U=await ee(a.id);U&&(m(U),U.allocations&&T(se=>({...se,total:U.allocations?U.allocations.length:0}))),q({bindAddress:"0.0.0.0"}),Ne("single"),g("success","Allocation created successfully")}catch(v){const _=v instanceof Error?v.message:"Failed to create allocation";X(_),g("error",_)}finally{w(!1)}},O=async()=>{for(const o of C)try{await me(o)}catch(v){console.error(`Failed to delete allocation ${o}:`,v)}R([])};return e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(I,{className:"bg-stone-950 border border-900",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"Port Allocations"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.length," total • ",t.length," in use"]})]}),C.length>0&&e.jsxs(N,{onClick:O,icon:e.jsx(Q,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"danger",children:["Delete Selected (",C.length,")"]})]}),e.jsxs("div",{className:"space-y-4",children:[J&&t.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-white mb-2",children:"In Use"}),e.jsx("div",{className:"space-y-2",children:r.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-950 rounded-md border border-stone-900",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ze,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-white",children:[o.bindAddress,":",o.port]}),(o.alias||o.notes)&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[o.alias&&e.jsx("span",{className:"font-medium",children:o.alias}),o.alias&&o.notes&&" • ",o.notes]})]})]}),e.jsx("span",{className:"text-xs text-gray-400",children:"In use"})]},o.id))})]}),d&&n.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-white mb-2",children:"Available"}),e.jsx("div",{className:"space-y-2",children:i.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-stone-950 rounded-md border border-stone-900 hover:border-stone-900",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-white",children:[o.bindAddress,":",o.port]}),(o.alias||o.notes)&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[o.alias&&e.jsx("span",{className:"font-medium",children:o.alias}),o.alias&&o.notes&&" • ",o.notes]})]})}),e.jsx(N,{onClick:()=>me(o.id),icon:e.jsx(Q,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"danger",children:"Delete"})]},o.id))})]}),s.length===0&&e.jsx("div",{className:"py-6 text-center",children:e.jsx("p",{className:"text-sm text-gray-400",children:"No allocations found"})})]}),s.length>0&&Pe(p,k)]})})}),e.jsx("div",{children:e.jsx(I,{className:"bg-stone-950 border border-stone-900 rounded-md shadow-xs",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"Create Allocation"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Allocate ports for your servers to use on this node."})]}),ne&&e.jsx(re,{type:"error",message:ne,onDismiss:()=>X(null)}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-white",children:"Bind Address"}),e.jsx("input",{type:"text",value:u.bindAddress,onChange:o=>q({...u,bindAddress:o.target.value}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-white
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,placeholder:"0.0.0.0",required:!0})]}),ve==="single"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-white",children:"Port"}),e.jsx("input",{type:"number",value:u.port||"",onChange:o=>q({...u,port:parseInt(o.target.value),portRange:void 0}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-[#FFFFFF]
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,min:1,max:65535,required:!0})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-white",children:"Start Port"}),e.jsx("input",{type:"number",value:((he=u.portRange)==null?void 0:he.start)||"",onChange:o=>{var v;return q({...u,port:void 0,portRange:{start:parseInt(o.target.value),end:((v=u.portRange)==null?void 0:v.end)||parseInt(o.target.value)}})},className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-[#FFFFFF]
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,min:1,max:65535,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-white",children:"End Port"}),e.jsx("input",{type:"number",value:((ue=u.portRange)==null?void 0:ue.end)||"",onChange:o=>{var v;return q({...u,port:void 0,portRange:{start:((v=u.portRange)==null?void 0:v.start)||parseInt(o.target.value),end:parseInt(o.target.value)}})},className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-[#FFFFFF]
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,min:1,max:65535,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-white",children:"Alias (Optional)"}),e.jsx("input",{type:"text",value:u.alias||"",onChange:o=>q({...u,alias:o.target.value}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-[#FFFFFF]
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,placeholder:"Primary game port"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-white",children:"Notes (Optional)"}),e.jsx("input",{type:"text",value:u.notes||"",onChange:o=>q({...u,notes:o.target.value}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-[#FFFFFF]
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,placeholder:"Additional information"})]})]}),e.jsx(N,{type:"submit",disabled:$,icon:$?e.jsx(Le,{}):null,variant:"secondary",children:$?"Creating...":"Create Allocation"})]})]})})})})]})},qe=()=>{var t,n,r;if(!a)return null;a.connectionKey||be(a.connectionKey||"");const s=F.filter(i=>i.node.id===a.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{onClick:()=>{y("list"),m(null)},icon:e.jsx(fe,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"secondary"}),e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-white",children:a.name})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{onClick:()=>{S({name:a.name,fqdn:a.fqdn,port:a.port}),y("edit")},icon:e.jsx(je,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"secondary",children:"Edit"}),e.jsx(N,{onClick:()=>de(a.id),icon:e.jsx(Q,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"danger",children:"Delete"})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(N,{onClick:()=>W("overview"),variant:h==="overview"?"primary":"secondary",className:h==="overview"?"font-bold":"font-normal",children:"Overview"}),e.jsxs(N,{onClick:()=>W("servers"),variant:h==="servers"?"primary":"secondary",className:h==="servers"?"font-bold":"font-normal",children:["Servers (",s.length,")"]}),e.jsx(N,{onClick:()=>W("allocations"),variant:h==="allocations"?"primary":"secondary",className:h==="allocations"?"font-bold":"font-normal",children:"Allocations"}),e.jsx(N,{onClick:()=>W("configure"),variant:h==="configure"?"primary":"secondary",className:h==="configure"?"font-bold":"font-normal",children:"Configure"})]}),h==="overview"?e.jsx(I,{className:"bg-stone-950 border border-stone-900",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Node ID"}),e.jsx("div",{className:"text-sm font-mono mt-1 text-gray-400",children:a.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Name"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"FQDN"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.fqdn})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Port"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.port})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Status"}),e.jsx("div",{className:"flex items-center space-x-2 mt-1",children:e.jsx(pe,{variant:a.isOnline?"success":"danger",children:a.isOnline?"Online":"Offline"})})]}),a.systemState&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pt-4 border-t border-stone-900",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Krypton Version"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.systemState.version})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"OS"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.systemState.osVersion})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Kernel"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.systemState.kernel})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"CPU Cores"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.systemState.cpuCores})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"System Memory"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:te(a.systemState.memoryTotal)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Docker Containers"}),e.jsxs("div",{className:"text-sm mt-1 text-gray-400",children:[a.systemState.containers.running," ","running,"," ",a.systemState.containers.stopped," ","stopped"]})]})]})}),e.jsxs("div",{className:"pt-4 border-t border-stone-900",children:[e.jsx("div",{className:"text-xs font-medium text-gray-400 mb-3",children:"Resource Allocation"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"CPU Allocated"}),e.jsxs("div",{className:"text-sm mt-1 text-gray-400",children:[(t=a.resources)==null?void 0:t.cpuAllocated,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Memory Allocated"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:te(((n=a.resources)==null?void 0:n.memoryAllocated)||0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Disk Allocated"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:te(((r=a.resources)==null?void 0:r.diskAllocated)||0)})]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-stone-900",children:[e.jsx("div",{className:"text-xs text-white",children:"Last Checked"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:new Date(a.lastChecked).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Created At"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:new Date(a.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Updated At"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:new Date(a.updatedAt).toLocaleString()})]})]})})}):h==="servers"?e.jsxs("div",{className:"space-y-2",children:[s.map(i=>e.jsx(I,{className:"bg-stone-950 border border-stone-900",children:e.jsxs("div",{className:"px-6 h-16 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`h-2 w-2 rounded-full ${i.status.state==="running"?"bg-green-400":"bg-gray-300"}`})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:i.name}),e.jsx("div",{className:"text-xs text-gray-400",children:i.internalId})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[e.jsxs("span",{className:"font-medium text-white",children:[i.cpuPercent,"%"]})," ","CPU"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[e.jsxs("span",{className:"font-medium text-white",children:[(i.memoryMiB/1024).toFixed(1)," GB"]})," ","RAM"]})]}),e.jsx(ge,{className:"w-4 h-4 text-gray-400"})]})]})},i.id)),s.length===0&&e.jsx(I,{className:"text-center py-6 bg-stone-900 rounded-md border border-stone-900",children:e.jsx("p",{className:"text-xs text-gray-400",children:"No servers found"})})]}):h==="allocations"?$e():e.jsx(I,{className:"bg-stone-950 border border-stone-900 rounded-md shadow-xs",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"Configure Krypton"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Follow these steps to configure Krypton on your node."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-white",children:"1. Navigate to Krypton Directory"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Open a terminal and navigate to your Krypton installation directory."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-white",children:"2. Run Configuration Script"}),e.jsx("div",{className:"mt-1 relative",children:e.jsx("div",{className:"bg-stone-950 border border-stone-900 p-3 pr-12 rounded-md font-mono text-xs overflow-x-auto text-gray-400",children:"bun run configure"})}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"This will start the interactive configuration process."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-white",children:"3. Connection Key"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"When prompted for the connection key, use the following:"}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsx("div",{className:"bg-stone-950 border border-stone-900 p-3 pr-12 rounded-md font-mono text-xs overflow-x-auto text-gray-400",children:a.connectionKey||"Loading..."}),e.jsx("button",{onClick:Ee,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-400 hover:text-gray-700 cursor-pointer",children:ye?e.jsx(Ve,{className:"w-4 h-4 text-green-500"}):e.jsx(Je,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-white",children:"4. Complete Configuration"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Answer any additional configuration questions. Once complete, Krypton will restart automatically with the new configuration."})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("p",{className:"text-xs text-gray-400",children:["Need help? Check out our"," ",e.jsx("a",{href:"https://docs.kyro.lol/krypton/configuration",target:"_blank",rel:"noreferrer",className:"text-stone-500 hover:underline",children:"configuration documentation"})," ","for detailed instructions."]})})]})]})})})]})},Te=()=>{const s=De();return e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-transparent",children:[e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>K("name"),children:e.jsx("div",{className:"flex items-center",children:"Name"})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>K("fqdn"),children:e.jsx("div",{className:"flex items-center",children:"FQDN"})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>K("port"),children:e.jsx("div",{className:"flex items-center",children:"Port"})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>K("status"),children:e.jsx("div",{className:"flex items-center",children:"Status"})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>K("servers"),children:e.jsx("div",{className:"flex items-center",children:"Servers"})}),e.jsx("th",{className:"p-3 text-right text-xs font-medium text-gray-400 tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-stone-950",children:[s.map(t=>{const n=F.filter(r=>r.node.id===t.id);return e.jsxs("tr",{className:"hover:bg-stone-900 cursor-pointer",onClick:()=>{m(t),y("view")},children:[e.jsx("td",{className:"p-3 text-xs text-gray-400",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{className:"w-4 h-4 mr-1.5 text-gray-400"}),e.jsx("span",{className:"font-medium text-white",children:t.name})]})}),e.jsx("td",{className:"p-3 text-xs text-white",children:t.fqdn}),e.jsx("td",{className:"p-3 text-xs text-white",children:t.port}),e.jsx("td",{className:"p-3 text-xs",children:e.jsx(pe,{variant:t.isOnline?"success":"danger",children:t.isOnline?"Online":"Offline"})}),e.jsxs("td",{className:"p-3 text-xs text-white",children:[n.length," ",n.length===1?"server":"servers",t.systemState&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",t.systemState.containers.running," running)"]})]}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsx("div",{className:"flex items-center justify-end",onClick:r=>r.stopPropagation(),children:e.jsx("button",{onClick:r=>{r.stopPropagation(),G({node:t,position:{x:r.clientX,y:r.clientY}})},className:"p-1 text-[#9CA3AF] cursor-pointer hover:text-white",children:e.jsx(_e,{className:"w-4 h-4"})})})})]},t.id)}),x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-4 text-center text-white text-xs",children:"No nodes found"})})]})]})})};return b&&x.length===0?e.jsx("div",{children:e.jsx("div",{className:"p-6 flex items-center justify-center h-64",children:e.jsxs("div",{className:"relative",children:[e.jsx("h2",{className:"text-white font-medium text-lg mb-1",children:"Fetching Docker information for one or more nodes..."}),e.jsx("p",{className:"text-gray-400 text-xs",children:"Unfortunately, this is quite a slow process. Give us a moment."})]})})}):e.jsxs("div",{className:"card bg-stone-950 min-h-screen",children:[ie.length>0&&e.jsx("div",{className:"mb-4 space-y-2",children:ie.map(s=>e.jsx(re,{type:s.type,message:s.message,onDismiss:()=>Fe(s.id)},s.id))}),e.jsxs("div",{className:"transition-all duration-200 ease-in-out flex flex-col",children:[E==="list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:"Nodes"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Nodes are where your servers run and live. Learn how to set up"," ",Be,"'s Krypton daemon via the"," ",e.jsx("a",{href:"https://docs.kyro.lol",target:"_blank",rel:"noreferrer",className:"text-stone-500 hover:underline",children:"documentation"}),"."]})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx(N,{onClick:()=>y("create"),icon:e.jsx(ze,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"secondary",children:"Create Node"})})]}),e.jsx(I,{className:"bg-stone-950 border border-stone-900",children:Te()})]}),E==="create"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{onClick:()=>{y("list"),m(null),S({name:"",fqdn:"",port:8080})},icon:e.jsx(fe,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"secondary",children:"Back"}),e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Create Node"})})]}),xe("create")]}),E==="edit"&&xe("edit"),E==="view"&&qe()]}),B&&e.jsx(et,{position:B.position,onClose:()=>G(null),onEdit:()=>{m(B.node),S({name:B.node.name,fqdn:B.node.fqdn,port:B.node.port}),y("edit"),G(null)},onDelete:()=>{de(B.node.id),G(null)}})]})};export{lt as default};
