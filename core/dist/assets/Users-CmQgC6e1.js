import{r as n,j as e,L as se,B as N,n as te,b as L,c as re,u as ae,m as ne}from"./main-D6weWVn6.js";import{C as M}from"./card-DxFMsxNs.js";import{F as ie,a as z}from"./PlusIcon-CtXArJJt.js";import{F as I}from"./ArrowLeftIcon-CzYvxG5u.js";import{F as O}from"./TrashIcon-CRYsBrOY.js";import{E as oe}from"./ellipsis-vertical-6VIw1Tgp.js";function ce({title:i,titleId:l,...u},j){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:j,"aria-labelledby":l},u),i?n.createElement("title",{id:l},i):null,n.createElement("path",{fillRule:"evenodd",d:"M11.484 2.17a.75.75 0 0 1 1.032 0 11.209 11.209 0 0 0 7.877 3.08.75.75 0 0 1 .722.515 12.74 12.74 0 0 1 .635 3.985c0 5.942-4.064 10.933-9.563 12.348a.749.749 0 0 1-.374 0C6.314 20.683 2.25 15.692 2.25 9.75c0-1.39.223-2.73.635-3.985a.75.75 0 0 1 .722-.516l.143.001c2.996 0 5.718-1.17 7.734-3.08ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75ZM12 15a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75v-.008a.75.75 0 0 0-.75-.75H12Z",clipRule:"evenodd"}))}const le=n.forwardRef(ce);function de({title:i,titleId:l,...u},j){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:j,"aria-labelledby":l},u),i?n.createElement("title",{id:l},i):null,n.createElement("path",{fillRule:"evenodd",d:"M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z",clipRule:"evenodd"}))}const me=n.forwardRef(de),_=({type:i,message:l,onDismiss:u})=>{const j=i==="error"?"bg-red-50":i==="success"?"bg-green-50":"bg-yellow-50",g=i==="error"?"text-red-600":i==="success"?"text-green-600":"text-yellow-600",w=i==="error"?"border-red-100":i==="success"?"border-green-100":"border-yellow-100";return e.jsxs("div",{className:`${j} border ${w} rounded-md flex items-start justify-between`,children:[e.jsxs("div",{className:"flex items-start p-2",children:[i==="error"||i==="warning"?e.jsx(te,{className:`w-3 h-3 ${g} mr-2 mt-0.5`}):null,e.jsx("p",{className:`text-xs ${g}`,children:l})]}),u&&e.jsx("button",{onClick:u,className:`ml-2 mr-2 p-1 ${g} hover:bg-opacity-10 cursor-pointer rounded-full`,children:"×"})]})},xe=({position:i,onClose:l,onEdit:u,onDelete:j})=>{const g=n.useRef(null),[w,C]=n.useState(i),{user:b}=re(),y=ae();n.useEffect(()=>{(!b||!b.permissions.includes("admin"))&&y("/unauthorized",{replace:!0})},[b,y]),n.useEffect(()=>{const a=o=>{g.current&&o.target instanceof HTMLElement&&!g.current.contains(o.target)&&l()},p=()=>{if(g.current){const o=g.current.getBoundingClientRect(),f={width:window.innerWidth,height:window.innerHeight};let E=i.x,S=i.y;E+o.width>f.width&&(E=Math.max(0,f.width-o.width-16)),S+o.height>f.height&&(S=Math.max(0,f.height-o.height-16)),C({x:E,y:S})}};document.addEventListener("mousedown",a);const m=setTimeout(p,10);return()=>{document.removeEventListener("mousedown",a),clearTimeout(m)}},[l,i]);const h=[{label:"Edit",icon:z,action:u},{label:"Delete",icon:O,action:j,destructive:!0}];return e.jsx(ne.div,{ref:g,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.1},className:"fixed z-50 w-36 bg-stone-950 border border-stone-900 rounded-lg py-1",style:{top:w.y,left:w.x},children:h.map(({label:a,icon:p,action:m,destructive:o})=>e.jsxs("button",{onClick:f=>{f.stopPropagation(),m()},className:`w-full px-3 py-2 text-left flex items-center space-x-2 text-sm ${o?"text-red-500 hover:bg-red-900/20":"text-[#9CA3AF] hover:bg-stone-900"}`,children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:a})]},a))})},we=()=>{const[i,l]=n.useState(null),[u,j]=n.useState([]),[g,w]=n.useState(!0),[C,b]=n.useState(null),[y,h]=n.useState("list"),[a,p]=n.useState(null),[m,o]=n.useState({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]}),[f,E]=n.useState("overview"),[S,A]=n.useState(null),[$,R]=n.useState([]),[D,G]=n.useState("username"),[W,P]=n.useState("asc");console.log(C);const T=[{id:"ADMIN",label:"Administrator",description:"Full access to all of {appName} & the admin panel"},{id:"USER",label:"User",description:"Standard user permissions"}];n.useEffect(()=>{F()},[]);const v=n.useCallback((t,s)=>{const r=Date.now().toString();return R(c=>[...c,{id:r,type:t,message:s}]),setTimeout(()=>{R(c=>c.filter(x=>x.id!==r))},5e3),r},[]),Z=n.useCallback(t=>{R(s=>s.filter(r=>r.id!==t))},[]),F=async()=>{try{w(!0);const s={Authorization:`Bearer ${localStorage.getItem("token")}`},r=await fetch("/api/users",{headers:s});if(!r.ok){const d=await r.json();throw new Error(d.error||"Failed to fetch users")}const x=(await r.json()).map(d=>({...d,createdAt:new Date(d.createdAt),updatedAt:new Date(d.updatedAt)}));j(x),b(null)}catch(t){const s=t instanceof Error?t.message:"An error occurred";b(s),v("error",s)}finally{w(!1)}},H=async t=>{try{w(!0);const s=localStorage.getItem("token"),r=await fetch(`/api/users/${t}`,{headers:{Authorization:`Bearer ${s}`}});if(!r.ok){const d=await r.json();throw new Error(d.error||"Failed to fetch user")}const c=await r.json(),x={...c,createdAt:new Date(c.createdAt),updatedAt:new Date(c.updatedAt)};return j(d=>d.map(k=>k.id===t?x:k)),a&&a.id===t&&p(x),b(null),x}catch(s){const r=s instanceof Error?s.message:"An error occurred";return v("error",r),null}finally{w(!1)}},q=async t=>{t.preventDefault(),A(null);try{const s=localStorage.getItem("token"),r=await fetch("/api/users",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(m)}),c=await r.json();if(!r.ok){const x=Array.isArray(c.error)?c.error.map(d=>d.message).join(", "):c.error||"Failed to create user";throw new Error(x)}await F(),h("list"),o({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]}),v("success",`User "${m.username}" created successfully`)}catch(s){const r=s instanceof Error?s.message:"Failed to create user";A(r),v("error",r)}},J=async t=>{if(t.preventDefault(),!!a){A(null);try{const s=localStorage.getItem("token"),r={...m};r.password||delete r.password;const c=await fetch(`/api/users/${a.id}`,{method:"PATCH",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(r)}),x=await c.json();if(!c.ok){const k=Array.isArray(x.error)?x.error.map(ee=>ee.message).join(", "):x.error||"Failed to update user";throw new Error(k)}await F(),v("success",`User "${m.username}" updated successfully`);const d=await H(a.id);d&&p(d),h("view"),o({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]})}catch(s){const r=s instanceof Error?s.message:"Failed to update user";A(r),v("error",r)}}},V=async t=>{try{const s=localStorage.getItem("token"),r=await fetch(`/api/users/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!r.ok){const c=await r.json();throw new Error(c.error||"Failed to delete user")}await F(),(a==null?void 0:a.id)===t&&(h("list"),p(null)),v("success","User deleted successfully")}catch(s){const r=s instanceof Error?s.message:"Failed to delete user";v("error",r)}},U=t=>{D===t?P(s=>s==="asc"?"desc":"asc"):(G(t),P("asc"))},X=()=>[...u].sort((t,s)=>{let r=0;switch(D){case"username":r=t.username.localeCompare(s.username);break;case"permissions":r=t.permissions.length-s.permissions.length;break;case"createdAt":r=t.createdAt.getTime()-s.createdAt.getTime();break;default:r=0}return W==="asc"?r:-r}),Y=t=>{o(s=>s.permissions.includes(t)?{...s,permissions:s.permissions.filter(r=>r!==t)}:{...s,permissions:[...s.permissions,t]})},B=t=>e.jsxs("form",{onSubmit:t==="create"?q:J,className:"space-y-4 max-w-lg",children:[S&&e.jsx(_,{type:"error",message:S,onDismiss:()=>A(null)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Username"}),e.jsx("input",{type:"text",value:m.username,onChange:s=>o({...m,username:s.target.value}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-[#FFFFFF]
                    focus:outline-none focus:ring-1 focus:ring-stone-90 focus:border-stone-900
                    transition-colors duration-200`,placeholder:"john.doe",required:!0,maxLength:100}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"A unique username for this user"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-400",children:["Password"," ",t==="edit"&&e.jsx("span",{className:"text-gray-400",children:"(leave blank to keep current)"})]}),e.jsx("input",{type:"password",value:m.password,onChange:s=>o({...m,password:s.target.value}),className:`mt-1 w-full px-3 py-2 rounded-md bg-stone-950 border border-stone-900
                    text-sm text-[#FFFFFF]
                    focus:outline-none focus:ring-1 focus:ring-stone-900 focus:border-stone-900
                    transition-colors duration-200`,placeholder:"••••••••",required:t==="create"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:t==="create"?"Must be at least 8 characters long":"Enter a new password or leave blank to keep the current one"})]}),e.jsx("div",{className:"space-y-1",children:e.jsx(M,{className:"mt-2 space-y-2 bg-stone-950 border border-stone-900 p-3",children:T.map(s=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("input",{type:"checkbox",id:`permission-${s.id}`,checked:m.permissions.includes(s.id),onChange:()=>Y(s.id),className:"mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:`permission-${s.id}`,className:"text-xs font-medium text-gray-400 cursor-pointer",children:s.label}),e.jsx("p",{className:"text-xs text-gray-400",children:s.description})]})]},s.id))})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{type:"button",onClick:()=>{h(t==="edit"?"view":"list"),t==="create"&&p(null),o({username:"",password:"",permissions:["SERVERS_VIEW","SERVERS_MANAGE"]})},children:"Cancel"}),e.jsx(N,{variant:"secondary",type:"submit",children:t==="create"?"Create User":"Update User"})]})]}),K=()=>a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 ",children:[e.jsx(N,{onClick:()=>{h("list"),p(null)},variant:"secondary",children:e.jsx(I,{className:"w-3.5 h-3.5 mr-1.5"})}),e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-gray-400",children:a.username})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(N,{onClick:()=>{o({username:a.username,password:"",permissions:a.permissions}),h("edit")},icon:e.jsx(z,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"secondary",children:"Edit"}),e.jsx(N,{onClick:()=>V(a.id),icon:e.jsx(O,{className:"w-3.5 h-3.5 mr-1.5"}),variant:"danger",children:"Delete"})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(N,{onClick:()=>E("overview"),variant:f==="overview"?"primary":"secondary",className:f==="overview"?"font-bold":"font-normal",children:"Overview"}),e.jsx(N,{onClick:()=>E("permissions"),variant:f==="permissions"?"primary":"secondary",className:f==="permissions"?"font-bold":"font-normal",children:"Permissions"})]}),f==="overview"?e.jsx(M,{className:"bg-stone-950 border border-stone-900",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"User ID"}),e.jsx("div",{className:"text-sm font-mono mt-1 text-gray-400",children:a.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Username"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.username})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Permissions"}),e.jsx("div",{className:"mt-1",children:e.jsx(L,{variant:"info",className:"text-xs",children:a.permissions[0]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Created At"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.createdAt.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-white",children:"Updated At"}),e.jsx("div",{className:"text-sm mt-1 text-gray-400",children:a.updatedAt.toLocaleString()})]})]})})}):e.jsx(M,{className:"bg-stone-950 border border-stone-900 rounded-md shadow-xs",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"User Permissions"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Permissions determine what actions the user can perform in the system."})]}),e.jsx("div",{className:"space-y-3",children:T.map(t=>e.jsx("div",{className:`p-3 rounded-md border ${a.permissions.includes(t.id),"bg-stone-950 border-stone-900"}`,children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`mt-0.5 mr-3 ${a.permissions.includes(t.id)?"text-gray-700":"text-gray-300"}`,children:e.jsx(le,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.label}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.description}),e.jsx("div",{className:"text-xs mt-1",children:a.permissions.includes(t.id)?e.jsx("span",{className:"text-green-600",children:"Granted"}):e.jsx("span",{className:"text-gray-400",children:"Not granted"})})]})]})},t.id))})]})})})]}):null,Q=()=>{const t=X();return e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-transparent",children:[e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>U("username"),children:e.jsx("div",{className:"flex items-center",children:"Username"})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>U("permissions"),children:e.jsx("div",{className:"flex items-center",children:"Permissions"})}),e.jsx("th",{className:"p-3 text-left text-xs font-medium text-gray-400 tracking-wider cursor-pointer",onClick:()=>U("createdAt"),children:e.jsx("div",{className:"flex items-center",children:"Created"})}),e.jsx("th",{className:"p-3 text-right text-xs font-medium text-gray-400 tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-stone-900 bg-stone-950",children:[t.map(s=>e.jsxs("tr",{className:"hover:bg-stone-900 cursor-pointer",onClick:()=>{p(s),h("view")},children:[e.jsx("td",{className:"p-3 text-xs text-white",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"font-medium",children:s.username})]})}),e.jsx("td",{className:"p-3 text-xs",children:e.jsx(L,{variant:"info",className:"text-xs",children:s.permissions[0]})}),e.jsx("td",{className:"p-3 text-xs text-gray-400",children:s.createdAt.toLocaleDateString()}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsx("div",{className:"flex items-center justify-end",onClick:r=>r.stopPropagation(),children:e.jsx("button",{onClick:r=>{r.stopPropagation(),l({user:s,position:{x:r.clientX,y:r.clientY}})},className:"p-1 text-[#9CA3AF] cursor-pointer hover:text-white",children:e.jsx(oe,{className:"w-4 h-4"})})})})]},s.id)),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400 text-xs",children:"No users found"})})]})]})})};return g&&u.length===0?e.jsx(se,{}):e.jsxs("div",{className:"card min-h-screen bg-stone-950",children:[$.length>0&&e.jsx("div",{className:"mb-4 space-y-2",children:$.map(t=>e.jsx(_,{type:t.type,message:t.message,onDismiss:()=>Z(t.id)},t.id))}),e.jsxs("div",{className:"transition-all duration-200 ease-in-out",children:[y==="list"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-[#FFFFFF]",children:"Users"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Manage users and their permissions for accessing the panel."})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx(N,{onClick:()=>h("create"),variant:"secondary",icon:e.jsx(ie,{className:"w-3.5 h-3.5 mr-1.5"}),children:"Create User"})})]}),e.jsx("div",{className:"bg-stone-950 border border-stone-900 rounded-md shadow-xs",children:Q()})]}),y==="create"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{h("list"),p(null)},className:"flex items-center text-gray-400 hover:bg-gray-100 p-2 cursor-pointer rounded-md transition hover:text-gray-900",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-lg font-semibold text-[#FFFFFF]",children:"Create User"})})]}),B("create")]}),y==="edit"&&B("edit"),y==="view"&&K()]}),i&&e.jsx(xe,{position:i.position,onClose:()=>l(null),onEdit:()=>{p(i.user),o({username:i.user.username,password:"",permissions:i.user.permissions}),h("edit"),l(null)},onDelete:()=>{V(i.user.id),l(null)}})]})};export{we as default};
