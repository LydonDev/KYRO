import{r as s,j as e,L as Z,A as $,B as b,a as Q,b as V,F as ee}from"./main-D6weWVn6.js";import{C as T,a as W}from"./card-DxFMsxNs.js";import{R as D,L as R,C as O,X as M,Y as P,T as z,a as U}from"./LineChart-BqF99DVK.js";function te({title:n,titleId:a,...r},c){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":a},r),n?s.createElement("title",{id:a},n):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const se=s.forwardRef(te);function re({title:n,titleId:a,...r},c){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":a},r),n?s.createElement("title",{id:a},n):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const ne=s.forwardRef(re);function ae({title:n,titleId:a,...r},c){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":a},r),n?s.createElement("title",{id:a},n):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const I=s.forwardRef(ae),_=(n,a=2)=>{if(!n||n===0)return"0 Bytes";const r=1024,c=a<0?0:a,y=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],p=Math.floor(Math.log(n)/Math.log(r));return parseFloat((n/Math.pow(r,p)).toFixed(c))+" "+y[p]},K=({active:n,payload:a,label:r,dataType:c})=>n&&a&&a.length?e.jsxs("div",{className:"bg-stone-950 border border-stone-900 rounded-md shadow-lg p-3 text-xs",children:[e.jsx("div",{className:"font-medium text-white mb-1",children:c==="cpu"?"CPU Usage":"Memory Usage"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`h-2 w-2 rounded-full mr-2 ${c==="cpu"?"bg-blue-500":"bg-green-500"}`}),e.jsxs("span",{className:"text-white",children:[a[0].value.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-stone-400 text-[10px] mt-1",children:new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}):null;function de(){const[n,a]=s.useState([]),[r,c]=s.useState([]),[y,p]=s.useState(!0),[w,S]=s.useState(null),[h,A]=s.useState("servers"),[C,Y]=s.useState(null),[H,q]=s.useState({}),[B,L]=s.useState({}),[f,N]=s.useState(0),F=s.useRef({});if(w)throw new Error(w);s.useEffect(()=>(G(),()=>{Object.values(F.current).forEach(t=>{t&&t.readyState===WebSocket.OPEN&&t.close()})}),[]),s.useEffect(()=>{c(n),n.forEach(t=>{t.node&&t.internalId&&t.validationToken&&E(t)})},[n]);const k={total:r.length,online:r.filter(t=>{var o,i;return((i=(o=t.status)==null?void 0:o.status)==null?void 0:i.state)==="running"}).length,offline:r.filter(t=>{var o,i;return((i=(o=t.status)==null?void 0:o.status)==null?void 0:i.state)!=="running"}).length},G=async()=>{try{p(!0);const t=localStorage.getItem("token"),o=await fetch("/api/servers?include[node]=true&include[status]=true",{headers:{Authorization:`Bearer ${t}`}});if(!o.ok)throw new Error("Failed to fetch servers");const i=await o.json();a(i),S(null)}catch(t){S(t instanceof Error?t.message:"An error occurred")}finally{p(!1)}},E=t=>{if(F.current[t.id]&&F.current[t.id].readyState===WebSocket.OPEN)return;B[t.id]||L(d=>({...d,[t.id]:Array(24).fill(0).map((m,u)=>({time:Date.now()-(23-u)*5e3,cpu:0,memory:0}))}));const o=`ws://${t.node.fqdn}:${t.node.port}?server=${t.internalId}&token=${t.validationToken}`,i=new WebSocket(o);F.current[t.id]=i,i.onopen=()=>{console.log(`WebSocket connected for server ${t.id}`)},i.onmessage=d=>{const m=JSON.parse(d.data);if(m.event==="stats"&&m.data){const{cpu_percent:u,memory:v,network:j}=m.data;if(u!==void 0){const g={cpuPercent:u||0,memory:v||{used:0,limit:0,percent:0},network:j?{rxBytes:j.rx_bytes,txBytes:j.tx_bytes}:{rxBytes:0,txBytes:0}};q(l=>({...l,[t.id]:g})),L(l=>{const x=[...l[t.id]||[]];return x.push({time:Date.now(),cpu:u||0,memory:v?v.percent:0}),x.length>24&&x.shift(),{...l,[t.id]:x}})}m.data.state&&a(g=>g.map(l=>l.id===t.id?{...l,state:m.data.state}:l))}},i.onclose=()=>{console.log(`WebSocket disconnected for server ${t.id}`),setTimeout(()=>{var d;((d=F.current[t.id])==null?void 0:d.readyState)===WebSocket.CLOSED&&E(t)},5e3)},i.onerror=d=>{console.error(`WebSocket error for server ${t.id}:`,d)}},J=()=>{f<r.length-1?N(f+1):N(0)},X=()=>{f>0?N(f-1):N(r.length-1)};return y?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(Z,{})}):w?e.jsx("div",{className:"p-6",children:e.jsx($,{type:"error",message:`Failed to load servers: ${w}`})}):e.jsx("div",{className:"card bg-stone-950 min-h-screen",children:e.jsxs("div",{className:"w-full mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-[#FFFFFF]",children:"Servers"}),e.jsx("p",{className:"text-sm text-[#9CA3AF]",children:"Manage your servers"})]})}),e.jsx(b,{variant:"secondary",size:"sm",icon:e.jsx(I,{className:"h-4 w-4"}),children:"Deploy Server"})]}),C&&e.jsx($,{type:"success",message:C,onDismiss:()=>Y(null)}),e.jsxs("div",{className:"mb-4 flex space-x-1",children:[e.jsxs(b,{onClick:()=>A("servers"),variant:h==="servers"?"primary":"secondary",className:h==="servers"?"font-bold":"font-normal",children:["Servers (",r.length,")"]}),e.jsx(b,{onClick:()=>A("overview"),variant:h==="overview"?"primary":"secondary",className:h==="overview"?"font-bold":"font-normal",children:"Overview"})]}),h==="servers"&&e.jsx("div",{children:r.length>0?e.jsx("div",{className:"w-full flex flex-col gap-4",children:r.length>0&&(()=>{var m,u,v,j,g;const t=r[f],o=((m=t.state)==null?void 0:m.toLowerCase())==="running",i=H[t.id]||{cpuPercent:0,memory:{used:0,limit:((u=t.status)==null?void 0:u.memory_limit)||0}},d=B[t.id]||Array(24).fill(0).map((l,x)=>({time:Date.now()-(23-x)*5e3,cpu:0,memory:0}));return e.jsx("div",{className:"bg-stone-950 rounded-lg border border-stone-900 shadow-md overflow-hidden p-6",children:e.jsxs("div",{children:[e.jsxs(Q,{to:`/servers/${t.id}/console`,className:"block transition-colors duration-150",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"text-2xl font-medium text-[#FFFFFF] truncate",children:t.name}),e.jsx(V,{variant:((v=t.state)==null?void 0:v.toLowerCase())==="running"?"success":"danger",children:t.state})]}),e.jsx("div",{className:"text-xs text-[#9CA3AF] mb-2",children:(()=>{var x;let l=null;try{(x=t.status)!=null&&x.allocation&&(l=JSON.parse(t.status.allocation))}catch{}return t.node&&l?`${t.node.fqdn}:${l.port}`:"-"})()}),e.jsxs("div",{className:"text-xs text-[#9CA3AF] mb-2",children:["#",t.internalId]}),e.jsx("div",{className:"text-[11px] text-[#6B7280] mb-2",children:e.jsx("span",{children:(g=(j=t.status)==null?void 0:j.status)==null?void 0:g.id})})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx(T,{className:"bg-stone-950 border border-stone-900 overflow-hidden w-full",children:e.jsxs(W,{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"text-xs font-medium text-[#9CA3AF]",children:"CPU Usage"}),e.jsx("div",{className:"text-xs font-medium text-[#3B82F6]",children:o?`${i.cpuPercent.toFixed(1)}%`:"-"})]}),e.jsx("div",{className:"h-[80px]",children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(R,{data:d,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(M,{dataKey:"time",tick:{fontSize:10,fill:"#9CA3AF"},stroke:"#4B5563",tickLine:!1,axisLine:!1,hide:!0}),e.jsx(P,{tick:{fontSize:10,fill:"#9CA3AF"},stroke:"#4B5563",tickLine:!1,axisLine:!1,domain:[0,100],hide:!0}),e.jsx(z,{content:e.jsx(K,{active:!0,payload:[],label:0,dataType:"cpu"}),cursor:{stroke:"#6B7280",strokeWidth:1,strokeDasharray:"3 3"}}),e.jsx(U,{type:"monotone",dataKey:"cpu",stroke:"#3B82F6",strokeWidth:2,dot:!1,activeDot:{r:4,fill:"#3B82F6",stroke:"#1E40AF"},isAnimationActive:!1})]})})}),!o&&e.jsx("div",{className:"text-center text-xs text-[#9CA3AF] mt-1",children:"Server offline"})]})}),e.jsx(T,{className:"bg-stone-950 border border-stone-900 overflow-hidden w-full",children:e.jsxs(W,{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"text-xs font-medium text-[#9CA3AF]",children:"Memory Usage"}),e.jsx("div",{className:"text-xs font-medium text-[#10B981]",children:o?`${_(i.memory.used)}`:"-"})]}),e.jsx("div",{className:"h-[80px]",children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(R,{data:d,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(M,{dataKey:"time",tick:{fontSize:10,fill:"#9CA3AF"},stroke:"#4B5563",tickLine:!1,axisLine:!1,hide:!0}),e.jsx(P,{tick:{fontSize:10,fill:"#9CA3AF"},stroke:"#4B5563",tickLine:!1,axisLine:!1,domain:[0,100],hide:!0}),e.jsx(z,{content:e.jsx(K,{active:!0,payload:[],label:0,dataType:"memory"}),cursor:{stroke:"#6B7280",strokeWidth:1,strokeDasharray:"3 3"}}),e.jsx(U,{type:"monotone",dataKey:"memory",stroke:"#10B981",strokeWidth:2,dot:!1,activeDot:{r:4,fill:"#10B981",stroke:"#065F46"},isAnimationActive:!1})]})})}),o?e.jsxs("div",{className:"text-center text-xs text-[#9CA3AF] mt-1",children:[_(i.memory.limit)," limit"]}):e.jsx("div",{className:"text-center text-xs text-[#9CA3AF] mt-1",children:"Server offline"})]})}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(b,{variant:"secondary",size:"sm",onClick:X,icon:e.jsx(se,{className:"h-4 w-4"}),disabled:r.length<=1,children:"Previous"}),e.jsxs("div",{className:"text-sm text-[#9CA3AF]",children:["Server ",f+1," of ",r.length]}),e.jsx(b,{variant:"secondary",size:"sm",onClick:J,icon:e.jsx(ne,{className:"h-4 w-4"}),disabled:r.length<=1,children:"Next"})]})]})]})},t.id)})()}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 bg-stone-950 rounded-lg border border-stone-900",children:[e.jsx("div",{className:"w-32 h-32 mb-6",children:e.jsx(ee,{className:"w-full h-full text-[#9CA3AF]"})}),e.jsx("h2",{className:"text-xl font-semibold text-[#FFFFFF] mb-2",children:"No servers found"}),e.jsx("p",{className:"text-[#9CA3AF] text-center max-w-md mb-6",children:"You don't have any active servers yet. To create a new server, please contact your administrator."}),e.jsx(b,{variant:"secondary",size:"sm",icon:e.jsx(I,{className:"h-4 w-4"}),children:"Deploy Server"})]})}),h==="overview"&&e.jsxs("div",{className:"bg-stone-950 rounded-md border border-stone-900 p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-[#FFFFFF] mb-4",children:"Server Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"border border-stone-900 rounded-md p-4",children:[e.jsx("div",{className:"text-[#9CA3AF] text-sm mb-1",children:"Total Servers"}),e.jsx("div",{className:"text-2xl font-medium text-[#FFFFFF]",children:k.total})]}),e.jsxs("div",{className:"border border-stone-900 rounded-md p-4",children:[e.jsx("div",{className:"text-[#9CA3AF] text-sm mb-1",children:"Online"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-[#10B981] mr-2"}),e.jsx("div",{className:"text-2xl font-medium text-[#FFFFFF]",children:k.online})]})]}),e.jsxs("div",{className:"border border-stone-900 rounded-md p-4",children:[e.jsx("div",{className:"text-[#9CA3AF] text-sm mb-1",children:"Offline"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-[#9CA3AF] mr-2"}),e.jsx("div",{className:"text-2xl font-medium text-[#FFFFFF]",children:k.offline})]})]})]})]})]})})}export{de as default};
